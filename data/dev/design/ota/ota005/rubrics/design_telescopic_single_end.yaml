weight_structural_correctness: 0.70
weight_topology_terms: 0.20
weight_safety: 0.10

structural_correctness_guidance: "Netlist structure matches the telescopic single-ended reference (NMOS/PMOS cascodes with single-ended output vop)."
topology_patterns_any: "telescopic; cascode; single-ended; single end"
topology_min_any: 2
safety_anti_patterns: "fully differential; two-stage"

hallucination_penalty: 0.15
min_pass: 0.70
answer_key_SPICE: |
  M3 N004 vip N006 0 nch W=2u L=0.18u
  M4 N005 vin N006 0 nch W=2u L=0.18u
  M1 vop vb3 N005 0 nch W=1u L=0.18u
  M2 N003 vb3 N004 0 nch W=1u L=0.18u
  M5 N006 vtail 0 0 nch W=1u L=0.5u
  M6 N003 N003 N001 VDD pch W=2u L=0.18u
  M7 vop N003 N002 VDD pch W=2u L=0.18u
  M8 N001 N001 VDD VDD pch W=4u L=0.18u
  M9 N002 N001 VDD VDD pch W=4u L=0.18u
  C1 vop 0 1p
  VDD VDD 0 1.8
answer_key_CASIR: |
  {
    "nets": [
      {"id":"VDD","type":"supply"},{"id":"GND","type":"supply"},
      {"id":"vip"},{"id":"vin"},{"id":"vb3","type":"bias"},{"id":"vtail","type":"bias"},
      {"id":"vop"},
      {"id":"N001"},{"id":"N002"},{"id":"N003"},{"id":"N004"},{"id":"N005"},{"id":"N006"}
    ],
    "motifs": [
      {"id":"dp","type":"DiffPairNMOS","ports":{"in_p":"vip","in_n":"vin","out_l":"N004","out_r":"N005","tail":"N006","gnd":"GND"}},
      {"id":"tail","type":"TailCurrentSourceNMOS","ports":{"out":"N006","gate":"vtail","gnd":"GND"}},
  
      {"id":"casL","type":"NMOSCascode","ports":{"in":"N004","mid":"N003","out":"(unused_L)","bias":"vb3","gnd":"GND"}},
      {"id":"casR","type":"NMOSCascode","ports":{"in":"N005","mid":"(unused_R_mid)","out":"vop","bias":"vb3","gnd":"GND"}},
  
      {"id":"ptop","type":"PMOSDiode","ports":{"node":"N001","vdd":"VDD"}},
      {"id":"pbranch","type":"PMOSMirror","ports":{"from":"N001","to":"N002","vdd":"VDD"}},
      {"id":"pcasbias","type":"PMOSDiodeLocal","ports":{"node":"N003","src":"N001"}},
  
      {"id":"pout","type":"PMOSCascodeElement","ports":{"out":"vop","gate":"N003","src":"N002"}},
  
      {"id":"cl","type":"Cap","ports":{"p":"vop","n":"GND"},"params":{"C":1e-12}}
    ],
    "provenance":{"source":"OTATelescopic_SE"}
  }
answer_key_CASCODE: |
  package analog.ota; import lib.motifs.*;
  
  class OTATelescopic_SE implements Amplifier {
    supply VDD=1.8V; ground GND;
    port in_p vip, in_n vin; port out vop;
    bias vb3, vtail;
  
    use {
      dp   = new DiffPairNMOS(vip, vin) { gnd=GND; tail=N006; };
      tail = new TailCurrentSourceNMOS() { out=N006; gate=vtail; gnd=GND; };
  
      // NMOS cascodes (both branches used to generate the proper cascode mid node)
      pair casN = NMOSCascode(dp.out_l, dp.out_r) { bias=vb3; gnd=GND; };
      alias N004 = casN.mid_r; alias N003 = casN.mid_l;   // preserve SPICE names
  
      // PMOS reference/bias network up top
      p_ref_top    = new PMOSDiode(node=N001, vdd=VDD);            // M8: N001 diode to VDD
      p_ref_branch = new PMOSMirror(from=N001, to=N002, vdd=VDD);  // M9: mirror to N002
      p_cas_bias   = new PMOSDiode(node=N003, vdd=N001);           // M6: diode from N3 to N1 (local source)
  
      // PMOS cascode element to output
      p_out = new PMOSCascodeElement(out=vop, gate=N003, src=N002);
  
      C(vop, GND, 1pF);
    }
  }
