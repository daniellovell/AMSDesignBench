weight_structural_correctness: 0.70
weight_topology_terms: 0.20
weight_safety: 0.10

structural_correctness_guidance: "Netlist structure matches the high-swing telescopic single-ended reference (n/p cascodes, PMOS high-swing elements, vop output)."
topology_patterns_any: "high-swing; telescopic; single-ended; single end"
topology_min_any: 2
safety_anti_patterns: "fully differential; two-stage"

hallucination_penalty: 0.15
min_pass: 0.70
answer_key_SPICE: |
  M3 N004 vip N006 0 nch W=2u L=0.18u
  M4 N005 vin N006 0 nch W=2u L=0.18u
  M1 vop vb2 N005 0 nch W=1u L=0.18u
  M2 N001 vb2 N004 0 nch W=1u L=0.18u
  M5 N006 vtail 0 0 nch W=1u L=0.5u
  M6 vop vb1 N003 VDD pch W=2u L=0.18u
  M7 N001 vb1 N002 VDD pch W=2u L=0.18u
  M8 N003 N001 VDD VDD pch W=4u L=0.18u
  M9 N002 N001 VDD VDD pch W=4u L=0.18u
  C1 vop 0 1p
  VDD VDD 0 1.8
  
answer_key_CASIR: |
  {
    "nets": [
      {"id":"VDD","type":"supply"},
      {"id":"GND","type":"supply"},
      {"id":"vip"},
      {"id":"vin"},
      {"id":"vb1","type":"bias"},
      {"id":"vb2","type":"bias"},
      {"id":"vtail","type":"bias"},
      {"id":"vop"},
      {"id":"N001"},
      {"id":"N002"},
      {"id":"N003"},
      {"id":"N004"},
      {"id":"N005"},
      {"id":"N006"}
    ],
    "motifs": [
      {
        "id":"dp",
        "type":"DiffPairNMOS",
        "ports":{"in_p":"vip","in_n":"vin","out_l":"N004","out_r":"N005","tail":"N006","gnd":"GND"}
      },
      {
        "id":"tail",
        "type":"TailCurrentSourceNMOS",
        "ports":{"out":"N006","gate":"vtail","gnd":"GND"}
      },
  
      // NMOS cascodes (gate = vb2)
      {
        "id":"ncas_out",
        "type":"NMOSCascode",
        "ports":{"in":"N005","out":"vop","bias":"vb2","gnd":"GND"}
      },
      {
        "id":"ncas_ref",
        "type":"NMOSCascode",
        "ports":{"in":"N004","out":"N001","bias":"vb2","gnd":"GND"}
      },
  
      // PMOS mirror pair with common gate node N001 (wide-swing reference)
      {
        "id":"pm_m8",
        "type":"PMOSMirror",
        "ports":{"from":"N001","to":"N003","vdd":"VDD"}
      },
      {
        "id":"pm_m9",
        "type":"PMOSMirror",
        "ports":{"from":"N001","to":"N002","vdd":"VDD"}
      },
  
      // PMOS cascode elements (gate = vb1) to extend swing
      {
        "id":"p_cas_out",
        "type":"PMOSCascodeElement",
        "ports":{"out":"vop","gate":"vb1","src":"N003"}
      },
      {
        "id":"p_cas_ref",
        "type":"PMOSCascodeElement",
        "ports":{"out":"N001","gate":"vb1","src":"N002"}
      },
  
      // Load capacitor
      {
        "id":"cl",
        "type":"Cap",
        "ports":{"p":"vop","n":"GND"},
        "params":{"C":1e-12}
      }
    ],
    "provenance":{"source":"OTATelescopic_SE_WS"}
  }
answer_key_CASCODE: |
  package analog.ota; import lib.motifs::*;
  
  class OTATelescopic_SE_WS implements Amplifier {
    supply VDD = 1.8V; ground GND;
    port in_p vip, in_n vin; port out vop;
    bias vb1, vb2, vtail;
  
    use {
      // Input differential pair with explicit tail node (N006)
      dp   = new DiffPairNMOS(vip, vin) { gnd=GND; tail=N006; };
      tail = new TailCurrentSourceNMOS() { out=N006; gate=vtail; gnd=GND; };
  
      // NMOS cascodes (vb2): right branch to output, left branch to reference node N001
      ncas_out = new NMOSCascode(in=N005, out=vop) { bias=vb2; gnd=GND; };   // M1
      ncas_ref = new NMOSCascode(in=N004, out=N001){ bias=vb2; gnd=GND; };   // M2
  
      // PMOS wide-swing active load:
      // - Mirror pair with common gate at N001 (M8,M9)
      // - Cascode devices with gate=vb1 to extend swing (M6 on out branch, M7 on ref branch)
      p_m8 = new PMOSMirror(from=N001, to=N003, vdd=VDD);                    // M8
      p_m9 = new PMOSMirror(from=N001, to=N002, vdd=VDD);                    // M9
      p_cas_out = new PMOSCascodeElement(out=vop, gate=vb1, src=N003);       // M6
      p_cas_ref = new PMOSCascodeElement(out=N001, gate=vb1, src=N002);      // M7
  
      // Load capacitor
      C(vop, GND, 1pF);
    }
  
    // Preserve SPICE node names (from the diff pair drains)
    alias N004 = dp.out_l; alias N005 = dp.out_r;
  }
