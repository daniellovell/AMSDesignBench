package analog.ota; import lib.motifs.*;

class OTATelescopic_SE implements Amplifier {
  supply VDD=1.8V; ground GND;
  port in_p vip, in_n vin; port out vop;
  bias vb3, vtail;

  use {
    dp   = new DiffPairNMOS(vip, vin) { gnd=GND; tail=N006; };
    tail = new TailCurrentSourceNMOS() { out=N006; gate=vtail; gnd=GND; };

    // NMOS cascodes (both branches used to generate the proper cascode mid node)
    pair casN = NMOSCascode(dp.out_l, dp.out_r) { bias=vb3; gnd=GND; };
    alias N004 = casN.mid_r; alias N003 = casN.mid_l;   // preserve SPICE names

    // PMOS reference/bias network up top
    p_ref_top    = new PMOSDiode(node=N001, vdd=VDD);            // M8: N001 diode to VDD
    p_ref_branch = new PMOSMirror(from=N001, to=N002, vdd=VDD);  // M9: mirror to N002
    p_cas_bias   = new PMOSDiode(node=N003, vdd=N001);           // M6: diode from N3 to N1 (local source)

    // NMOS cascode element to output
    p_out = new PMOSCascodeElement(out=vop, gate=N003, src=N002);

    C(vop, GND, 1pF);
  }
}
